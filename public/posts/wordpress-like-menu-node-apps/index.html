<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Menu system in Node Apps like WordPress Menu | limistah</title>
<meta name=keywords content><meta name=description content="You might have been in this kind of trap before or currently in one, well, I just want to tell you that I know your pain.
In a custom built CMS, managing of Menu and navigation in the site from the Admin Dashboard is a requirement. While it is interesting to use, it is not as interesting to build.
I just walked past this process, here, I am sharing how I have conquered it."><meta name=author content="AI"><link rel=canonical href=https://limistah.dev/posts/wordpress-like-menu-node-apps/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://limistah.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://limistah.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://limistah.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://limistah.dev/apple-touch-icon.png><link rel=mask-icon href=https://limistah.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Menu system in Node Apps like WordPress Menu"><meta property="og:description" content="You might have been in this kind of trap before or currently in one, well, I just want to tell you that I know your pain.
In a custom built CMS, managing of Menu and navigation in the site from the Admin Dashboard is a requirement. While it is interesting to use, it is not as interesting to build.
I just walked past this process, here, I am sharing how I have conquered it."><meta property="og:type" content="article"><meta property="og:url" content="https://limistah.dev/posts/wordpress-like-menu-node-apps/"><meta property="og:image" content="https://limistah.dev/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-25T00:00:00+00:00"><meta property="article:modified_time" content="2020-01-25T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://limistah.dev/images/papermod-cover.png"><meta name=twitter:title content="Menu system in Node Apps like WordPress Menu"><meta name=twitter:description content="You might have been in this kind of trap before or currently in one, well, I just want to tell you that I know your pain.
In a custom built CMS, managing of Menu and navigation in the site from the Admin Dashboard is a requirement. While it is interesting to use, it is not as interesting to build.
I just walked past this process, here, I am sharing how I have conquered it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://limistah.dev/posts/"},{"@type":"ListItem","position":2,"name":"Menu system in Node Apps like WordPress Menu","item":"https://limistah.dev/posts/wordpress-like-menu-node-apps/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Menu system in Node Apps like WordPress Menu","name":"Menu system in Node Apps like WordPress Menu","description":"You might have been in this kind of trap before or currently in one, well, I just want to tell you that I know your pain.\nIn a custom built CMS, managing of Menu and navigation in the site from the Admin Dashboard is a requirement. While it is interesting to use, it is not as interesting to build.\nI just walked past this process, here, I am sharing how I have conquered it.","keywords":[],"articleBody":"You might have been in this kind of trap before or currently in one, well, I just want to tell you that I know your pain.\nIn a custom built CMS, managing of Menu and navigation in the site from the Admin Dashboard is a requirement. While it is interesting to use, it is not as interesting to build.\nI just walked past this process, here, I am sharing how I have conquered it.\nTo consider I have a limitation for the menu to be deeply nested not more than two steps, so in this case, this is to ensure that the loops that I will write won’t have to be too recursive - which if not properly handled could create havoc.\nModel/Database In my database, I have the menu store as a flat document with each of them having their own information. The menu model has the following properties:\nposition: Position of the menu (Determined by the application, in my case, “Main Nav”, and “Footer Menu”) **name:**Text that the user would see parent: String containing the index of the parent or index of the grand parent with the index of the parent separated by a dot in the case of nesting url: The URL to map the navigation to weight The sorting order for the menu. So, with the above fields, I can create a menu like this:\nconst mainMenu = [ { name: \"Home\", url: \"/\", position: \"Main Nav\", parent: null, weight: 1 }, { name: \"Listings\", url: \"/listings\", position: \"Main Nav\", parent: null, weight: 2 }, { name: \"Categories\", url: \"/categories\", position: \"Main Nav\", parent: null, weight: 3 }, { name: \"Pricing\", url: \"/pricing\", position: \"Main Nav\", parent: null, weight: 4 }, { name: \"Pages\", url: \"#\", position: \"Main Nav\", parent: null, weight: 5 }, { name: \"About\", url: \"#\", position: \"Main Nav\", parent: 5, weight: 1 }, { name: \"Contact\", url: \"/contact\", position: \"Main Nav\", parent: \"5.1\", weight: 1 } ].map(async menu =\u003e { const mainMenu = new Menu(); Object.assign(mainMenu, menu); // Populates the fields to the mainMenu object await mainMenu.save(); // Saves the menu }); First problem has been solved.\nNext problem is making the data of the menu available in a format that we can render more easily.\nMenu parser middleware To solve this, I created a middleware which sets a global value for my view engine. The code in the middleware looks like this:\nasync handle({ request, view }, next) { // call next to advance the request // Can be MongoDB Model, this is AdonisJS const MenuService = use(\"App/Services/Admin/MenuService\"); const menuService = new MenuService(); const menus = await menuService.findAll(\"position\"); // Parsing of the menu comes in here // At this point built menu contains keys of menu positions, the value of every keys is an array of nested values that can be passed to drag and drop UI libraries like JQuery nestable for admin configuration using a browser. // Adonis code to share values across all views. view.share({ siteMenus: builtMenu }); } Parsing of Zero Level menus and sorting After the middleware has been defined, first is to understand that our menu won’t go more than two levels, with the zero level being the parent to other menus. To get the parent out of the menu, we map through all the items in the menus variable, getting all the elements that has just no dot in their parent value then storing them at a position defined in the builtMenu object\nconst builtMenu = {}; const menuWithParent = []; // Stores all menu that has parent for later processing // First of all, gather all the menus with same position to the same index menus.map(menu =\u003e { // The position for the current menu does not exist in the builtMenu object if (!builtMenu[menu.position]) { // Create it with an empty array builtMenu[menu.position] = []; } // If this menu does not have parent, push it directly into its position key in the builtMenu variable if (!menu.parent) { builtMenu[menu.position].push(menu); } else { // Else, push for later processing menuWithParent.push(menu); } }); Before we move forward, we should add code that sorts the generated menu so far, the easiest way is to get the keys in the built menu and map through each keys, then running the sort aggregation method on each item of the builtMenu data.\nThis sorting only compares the weight of each menu item, these weights are expected to go in ascending order, hence we can use a.weight \u003e b.weight so that we can have lowest number comes first ahead of larger number\nconst sortedMenu = {}; // Holds all the menu that has been sorted // Sorts all the menu in their respective positions, just to maintain ordering Object.keys(builtMenu).map(positionKey =\u003e { const menuAtPosition = builtMenu[positionKey]; sortedMenu[positionKey] = menuAtPosition.sort( (a, b) =\u003e a.weight \u003e b.weight ); }); At this stage, our builtMenu should look like this:\n{ \"Main Menu\": [ { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu, // \u003c- Menu details } ] } What we have to do next is work with the menus that exist in the menuWithParent variable that was gathered while pulling the menus that do not have child/grandchild.\nParsing of First Level menus and sorting To do this, we map through all the item in the variable, ensure that it does not have grandparent, if it does we push it to the menuWithGrandParent array for later processing, if it does not, we append the menu to the parent after creating a children array in to the parent if children array does not exist in the parent.\nWe also sort the menu generated so far after pushing to the parent, to maintain ordering of the menu.\n// This variable holds the menus that has grandparent const menuWithGrandParent = []; // We want to work on the menu that has parent menuWithParent.map(menu =\u003e { // following the structure of our menu in the database, parentIndex is the value of the parent key of every menu that has parent let parentIndex = menu.parent; // We still have to determine if the menu is a grandchild of a parent, so we split by the dot separator that we have used then use the length of the array as a determinant const hasGrandChild = parentIndex.split(\".\").length \u003e 1; // This menu is not a grandchild, we can proceed with our process if (!hasGrandChild) { // We need to get the position of the menu const menusAtPosition = builtMenu[menu.position]; parentIndex = parseInt(parentIndex); // Decrements the parentIndex to get the index in the array, in any case the reducing by 1 is lesser than zero, we want to default to index 0 else we want to get the index in the array const parent = menusAtPosition[parentIndex - 1 \u003c 0 ? 0 : parentIndex - 1]; // If the parent does not have children, we to initialize that to an array if (!parent.children) { parent.children = []; } // Push the new child of the parent into its children parent.children.push(menu); // Sort the children in the parent to maintain ordering parent.children.sort((a, b) =\u003e a.weight \u003e b.weight); } else { // This menu has a grandparent, we can not process it like this, we push to the menuWithGrandParent array and process after this menuWithGrandParent.push(menu); } }); And our builtMenu should now look like this:\nAt this stage, our builtMenu should look like this:\n{ \"Main Menu\": [ { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { // Parent Menu ...menu, // \u003c- Menu details children: [ { // Child Menu ...menu, // \u003c- Menu details }, ] } ] } Parsing of Second Level menus and sorting Now that we have the parent and children out, we are left with just one level deep, which is for the grandchild. The code is similar to the one that generate the children menus just that we have to get the index for the parent, grandparent and ensure that they have children or we create one for them before we can append the new array into them.\n// Processes menu that has grandparent menuWithGrandParent.map(menu =\u003e { // Get the parent of the parent let menuParent = menu.parent; // Split the parent to get the index of the parent and grand parent const indexSplit = menuParent.split(\".\"); // Get the position of this menu const grandChildMenuPosition = builtMenu[menu.position]; // Get the index of the grand parent const grandParentIndex = indexSplit[0] - 1 \u003c 0 ? 0 : indexSplit[0] - 1; // Set the index of the parent const parentIndex = indexSplit[1] - 1 \u003c 0 ? 0 : indexSplit[1] - 1; // The menus at the position of the grand child menu using the grand parent index const grandParentMenu = grandChildMenuPosition[grandParentIndex]; // If this grand parent has children, which we expect that it should if (grandParentMenu.children) { // We get the parent of the menu from the grandparent's children const parent = grandParentMenu.children[parentIndex]; // if the parent exists if (parent) { // Initialize children on the parent if it has none if (!parent.children) { parent.children = []; } // Push the menu to the parent under the grand parent parent.children.push(menu); // SOrt the children of the parent of the grandchild to maintain the ordering parent.children.sort((a, b) =\u003e a.weight \u003e b.weight); } } }); Finally, our builtMenu should look like this:\n{ \"Main Menu\": [ { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { ...menu // \u003c- Menu details }, { // Grand Parent Menu ...menu, // \u003c- Menu details children: [ { // Parent Menu ...menu, // \u003c- Menu details ...menu, // \u003c- Menu details children: [ { // Child Menu ...menu, // \u003c- Menu details }, ] }, ] } ] } Putting it all together Compiling all together, the middleware looks like:\nasync handle({ request, view }, next) { // call next to advance the request // Can be MongoDB Model, this is AdonisJS const MenuService = use(\"App/Services/Admin/MenuService\"); const menuService = new MenuService(); const menus = await menuService.findAll(\"position\"); const builtMenu = {}; const menuWithParent = []; // Stores all menu that has parent for later processing // First of all, gather all the menus with same position to the same index menus.map(menu =\u003e { // The position for the current menu does not exist in the builtMenu object if (!builtMenu[menu.position]) { // Create it with an empty array builtMenu[menu.position] = []; } // If this menu does not have parent, push it directly into its position key in the builtMenu variable if (!menu.parent) { builtMenu[menu.position].push(menu); } else { // Else, push for later processing menuWithParent.push(menu); } }); const sortedMenu = {}; // Holds all the menu that has been sorted // Sorts all the menu in their respective positions, just to maintain ordering Object.keys(builtMenu).map(positionKey =\u003e { const menuAtPosition = builtMenu[positionKey]; sortedMenu[positionKey] = menuAtPosition.sort( (a, b) =\u003e a.weight \u003e b.weight ); }); // This variable holds the menus that has grandparent const menuWithGrandParent = []; // We want to work on the menu that has parent menuWithParent.map(menu =\u003e { // following the structure of our menu in the database, parentIndex is the value of the parent key of every menu that has parent let parentIndex = menu.parent; // We still have to determine if the menu is a grandchild of a parent, so we split by the dot separator that we have used then use the length of the array as a determinant const hasGrandChild = parentIndex.split(\".\").length \u003e 1; // This menu is not a grandchild, we can proceed with our process if (!hasGrandChild) { // We need to get the position of the menu const menusAtPosition = builtMenu[menu.position]; parentIndex = parseInt(parentIndex); // Decrements the parentIndex to get the index in the array, in any case the reducing by 1 is lesser than zero, we want to default to index 0 else we want to get the index in the array const parent = menusAtPosition[parentIndex - 1 \u003c 0 ? 0 : parentIndex - 1]; // If the parent does not have children, we to initialize that to an array if (!parent.children) { parent.children = []; } // Push the new child of the parent into its children parent.children.push(menu); // Sort the children in the parent to maintain ordering parent.children.sort((a, b) =\u003e a.weight \u003e b.weight); } else { // This menu has a grandparent, we can not process it like this, we push to the menuWithGrandParent array and process after this menuWithGrandParent.push(menu); } }); // Processes menu that has grandparent menuWithGrandParent.map(menu =\u003e { // Get the parent of the parent let menuParent = menu.parent; // Split the parent to get the index of the parent and grand parent const indexSplit = menuParent.split(\".\"); // Get the position of this menu const grandChildMenuPosition = builtMenu[menu.position]; // Get the index of the grand parent const grandParentIndex = indexSplit[0] - 1 \u003c 0 ? 0 : indexSplit[0] - 1; // Set the index of the parent const parentIndex = indexSplit[1] - 1 \u003c 0 ? 0 : indexSplit[1] - 1; // The menus at the position of the grand child menu using the grand parent index const grandParentMenu = grandChildMenuPosition[grandParentIndex]; // If this grand parent has children, which we expect that it should if (grandParentMenu.children) { // We get the parent of the menu from the grandparent's children const parent = grandParentMenu.children[parentIndex]; // if the parent exists if (parent) { // Initialize children on the parent if it has none if (!parent.children) { parent.children = []; } // Push the menu to the parent under the grand parent parent.children.push(menu); // SOrt the children of the parent of the grandchild to maintain the ordering parent.children.sort((a, b) =\u003e a.weight \u003e b.weight); } } }); // At this point built menu contains keys of menu positions, the value of every keys is an array of nested values that can be passed to drag and drop UI libraries like JQuery nestable for admin configuration using a browser. // Adonis code to share values across all views. view.share({ siteMenus: builtMenu }); } Consuming the menu data from frontend The easiest way to consume the menu is to use a JQuery plugin called nestable++, the plugin make updating, creating and storing of the menu easier with the data that we have.\nIt expects an ordered list to be populated with list items and if children is expected, the list items should contain another unordered list with the children as the list items.\nIn our own case, once the view has set a JavaScript object with the menu data as its value, we can do something like this:\nlet CURRENT_MENU = \"Main Menu\"; $(function() { function decodeHtml(html) { var txt = document.createElement(\"textarea\"); txt.innerHTML = html; return txt.value; } const siteMenus = JSON.parse(decodeHtml(window._siteMenus)); // This initializes the drag and drop nestable listing nestableMenuBuilder(siteMenus[CURRENT_MENU], { maxDepth: 3 }); }); The nestableMenuBuilder function looks like this:\nconst nestableMenuBuilder = function(menuList, options = {}) { // Creates a single menu item that the nestable understands const menuItem = function(item) { return $(` ","wordCount":"2732","inLanguage":"en","datePublished":"2020-01-25T00:00:00Z","dateModified":"2020-01-25T00:00:00Z","author":{"@type":"Person","name":"AI"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://limistah.dev/posts/wordpress-like-menu-node-apps/"},"publisher":{"@type":"Organization","name":"limistah","logo":{"@type":"ImageObject","url":"https://limistah.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://limistah.dev accesskey=h title="limistah (Alt + H)">limistah</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://limistah.dev/blog title=Blog><span>Blog</span></a></li><li><a href=https://limistah.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://limistah.dev>Home</a>&nbsp;»&nbsp;<a href=https://limistah.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Menu system in Node Apps like WordPress Menu</h1><div class=post-meta><span title='2020-01-25 00:00:00 +0000 UTC'>January 25, 2020</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;AI&nbsp;|&nbsp;<a href=https://github.com/limistah/limistah.xyz/tree/main/content/posts/wordpress-like-menu-node-apps.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#to-consider aria-label="To consider">To consider</a></li></ul><li><a href=#modeldatabase aria-label=Model/Database>Model/Database</a><ul><li><a href=#menu-parser-middleware aria-label="Menu parser middleware">Menu parser middleware</a></li><li><a href=#parsing-of-zero-level-menus-and-sorting aria-label="Parsing of Zero Level menus and sorting">Parsing of Zero Level menus and sorting</a></li><li><a href=#parsing-of-first-level-menus-and-sorting aria-label="Parsing of First Level menus and sorting">Parsing of First Level menus and sorting</a></li><li><a href=#parsing-of-second-level-menus-and-sorting aria-label="Parsing of Second Level menus and sorting">Parsing of Second Level menus and sorting</a></li><li><a href=#putting-it-all-together aria-label="Putting it all together">Putting it all together</a></li><li><a href=#consuming-the-menu-data-from-frontend aria-label="Consuming the menu data from frontend">Consuming the menu data from frontend</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></li></ul></div></details></div><div class=post-content><p>You might have been in this kind of trap before or currently in one, well, I just want to tell you that I know your pain.</p><p>In a custom built CMS, managing of Menu and navigation in the site from the Admin Dashboard is a requirement. While it is interesting to use, it is not as interesting to build.</p><p>I just walked past this process, here, I am sharing how I have conquered it.</p><h3 id=to-consider>To consider<a hidden class=anchor aria-hidden=true href=#to-consider>#</a></h3><p>I have a limitation for the menu to be deeply nested not more than two steps, so in this case, this is to ensure that the loops that I will write won&rsquo;t have to be too recursive - which if not properly handled could create havoc.</p><h2 id=modeldatabase>Model/Database<a hidden class=anchor aria-hidden=true href=#modeldatabase>#</a></h2><p>In my database, I have the menu store as a flat document with each of them having their own information. The menu model has the following properties:</p><ul><li><strong>position:</strong> Position of the menu (Determined by the application, in my case, &ldquo;Main Nav&rdquo;, and &ldquo;Footer Menu&rdquo;)</li><li>**name:**Text that the user would see</li><li><strong>parent:</strong> String containing the index of the parent or index of the grand parent with the index of the parent separated by a dot in the case of nesting</li><li><strong>url:</strong> The URL to map the navigation to</li><li><strong>weight</strong> The sorting order for the menu.</li></ul><p>So, with the above fields, I can create a menu like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mainMenu</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Home&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Listings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;/listings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Categories&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;/categories&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Pricing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;/pricing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Pages&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;#&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;About&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;#&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Contact&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;/contact&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span><span class=o>:</span> <span class=s2>&#34;Main Nav&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>parent</span><span class=o>:</span> <span class=s2>&#34;5.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>weight</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>].</span><span class=nx>map</span><span class=p>(</span><span class=kr>async</span> <span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>mainMenu</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Menu</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>(</span><span class=nx>mainMenu</span><span class=p>,</span> <span class=nx>menu</span><span class=p>);</span> <span class=c1>// Populates the fields to the mainMenu object
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>mainMenu</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span> <span class=c1>// Saves the menu
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></div><p>First problem has been solved.</p><p>Next problem is making the data of the menu available in a format that we can render more easily.</p><h3 id=menu-parser-middleware>Menu parser middleware<a hidden class=anchor aria-hidden=true href=#menu-parser-middleware>#</a></h3><p>To solve this, I created a middleware which sets a global value for my view engine. The code in the middleware looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=nx>handle</span><span class=p>({</span> <span class=nx>request</span><span class=p>,</span> <span class=nx>view</span> <span class=p>},</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// call next to advance the request
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Can be MongoDB Model, this is AdonisJS
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>MenuService</span> <span class=o>=</span> <span class=nx>use</span><span class=p>(</span><span class=s2>&#34;App/Services/Admin/MenuService&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>menuService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MenuService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>menus</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>menuService</span><span class=p>.</span><span class=nx>findAll</span><span class=p>(</span><span class=s2>&#34;position&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Parsing of the menu comes in here
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// At this point built menu contains keys of menu positions, the value of every keys is an array of nested values that can be passed to drag and drop UI libraries like JQuery nestable for admin configuration using a browser.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Adonis code to share values across all views.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>view</span><span class=p>.</span><span class=nx>share</span><span class=p>({</span> <span class=nx>siteMenus</span><span class=o>:</span> <span class=nx>builtMenu</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=parsing-of-zero-level-menus-and-sorting>Parsing of Zero Level menus and sorting<a hidden class=anchor aria-hidden=true href=#parsing-of-zero-level-menus-and-sorting>#</a></h3><p>After the middleware has been defined, first is to understand that our menu won&rsquo;t go more than two levels, with the zero level being the parent to other menus. To get the parent out of the menu, we map through all the items in the <code>menus</code> variable, getting all the elements that has just no dot in their parent value then storing them at a position defined in the <code>builtMenu</code> object</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>builtMenu</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>menuWithParent</span> <span class=o>=</span> <span class=p>[];</span> <span class=c1>// Stores all menu that has parent for later processing
</span></span></span><span class=line><span class=cl><span class=c1>// First of all, gather all the menus with same position to the same index
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>menus</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// The position for the current menu does not exist in the builtMenu object 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create it with an empty array
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// If this menu does not have parent, push it directly into its position key in the builtMenu variable
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>menu</span><span class=p>.</span><span class=nx>parent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Else, push for later processing
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>menuWithParent</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Before we move forward, we should add code that sorts the generated menu so far, the easiest way is to get the keys in the built menu and map through each keys, then running the <code>sort</code> aggregation method on each item of the <code>builtMenu</code> data.</p><p>This sorting only compares the weight of each menu item, these weights are expected to go in ascending order, hence we can use <code>a.weight > b.weight</code> so that we can have lowest number comes first ahead of larger number</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sortedMenu</span> <span class=o>=</span> <span class=p>{};</span> <span class=c1>// Holds all the menu that has been sorted
</span></span></span><span class=line><span class=cl><span class=c1>// Sorts all the menu in their respective positions, just to maintain ordering
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>builtMenu</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>positionKey</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>menuAtPosition</span> <span class=o>=</span> <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>positionKey</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>sortedMenu</span><span class=p>[</span><span class=nx>positionKey</span><span class=p>]</span> <span class=o>=</span> <span class=nx>menuAtPosition</span><span class=p>.</span><span class=nx>sort</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>weight</span> <span class=o>&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>weight</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>At this stage, our <code>builtMenu</code> should look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Main Menu&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>      <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>What we have to do next is work with the menus that exist in the <code>menuWithParent</code> variable that was gathered while pulling the menus that do not have child/grandchild.</p><h3 id=parsing-of-first-level-menus-and-sorting>Parsing of First Level menus and sorting<a hidden class=anchor aria-hidden=true href=#parsing-of-first-level-menus-and-sorting>#</a></h3><p>To do this, we map through all the item in the variable, ensure that it does not have grandparent, if it does we push it to the <code>menuWithGrandParent</code> array for later processing, if it does not, we append the menu to the parent after creating a children array in to the parent if children array does not exist in the parent.</p><p>We also sort the menu generated so far after pushing to the parent, to maintain ordering of the menu.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// This variable holds the menus that has grandparent
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>menuWithGrandParent</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// We want to work on the menu that has parent
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>menuWithParent</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// following the structure of our menu in the database, parentIndex is the value of the parent key of every menu that has parent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>parentIndex</span> <span class=o>=</span> <span class=nx>menu</span><span class=p>.</span><span class=nx>parent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// We still have to determine if the menu is a grandchild of a parent, so we split by the dot separator that we have used then use the length of the array as a determinant
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>hasGrandChild</span> <span class=o>=</span> <span class=nx>parentIndex</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>).</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// This menu is not a grandchild, we can proceed with our process
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hasGrandChild</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// We need to get the position of the menu
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>menusAtPosition</span> <span class=o>=</span> <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nx>parentIndex</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>parentIndex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Decrements the parentIndex to get the index in the array, in any case the reducing by 1 is lesser than zero, we want to default to index 0 else we want to get the index in the array 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>parent</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=nx>menusAtPosition</span><span class=p>[</span><span class=nx>parentIndex</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>parentIndex</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If the parent does not have children, we to initialize that to an array
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Push the new child of the parent into its children
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Sort the children in the parent to maintain ordering
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>sort</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>weight</span> <span class=o>&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>weight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// This menu has a grandparent, we can not process it like this, we push to the menuWithGrandParent array and process after this
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>menuWithGrandParent</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>And our <code>builtMenu</code> should now look like this:</p><p>At this stage, our <code>builtMenu</code> should look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Main Menu&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=c1>// Parent Menu
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=err>children:</span> <span class=err>[</span>
</span></span><span class=line><span class=cl>        <span class=err>{</span>  <span class=c1>// Child Menu
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=err>]</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h3 id=parsing-of-second-level-menus-and-sorting>Parsing of Second Level menus and sorting<a hidden class=anchor aria-hidden=true href=#parsing-of-second-level-menus-and-sorting>#</a></h3><p>Now that we have the parent and children out, we are left with just one level deep, which is for the grandchild. The code is similar to the one that generate the children menus just that we have to get the index for the parent, grandparent and ensure that they have children or we create one for them before we can append the new array into them.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Processes menu that has grandparent
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>menuWithGrandParent</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Get the parent of the parent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>menuParent</span> <span class=o>=</span> <span class=nx>menu</span><span class=p>.</span><span class=nx>parent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Split the parent to get the index of the parent and grand parent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>indexSplit</span> <span class=o>=</span> <span class=nx>menuParent</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Get the position of this menu
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>grandChildMenuPosition</span> <span class=o>=</span> <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Get the index of the grand parent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>grandParentIndex</span> <span class=o>=</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Set the index of the parent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>parentIndex</span> <span class=o>=</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// The menus at the position of the grand child menu using the grand parent index 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>grandParentMenu</span> <span class=o>=</span> <span class=nx>grandChildMenuPosition</span><span class=p>[</span><span class=nx>grandParentIndex</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=c1>// If this grand parent has children, which we expect that it should
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>grandParentMenu</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// We get the parent of the menu from the grandparent&#39;s children
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>parent</span> <span class=o>=</span> <span class=nx>grandParentMenu</span><span class=p>.</span><span class=nx>children</span><span class=p>[</span><span class=nx>parentIndex</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>// if the parent exists
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>parent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Initialize children on the parent if it has none
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Push the menu to the parent under the grand parent
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// SOrt the children of the parent of the grandchild to maintain the ordering
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>sort</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>weight</span> <span class=o>&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>weight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>Finally, our <code>builtMenu</code> should look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Main Menu&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=err>...menu</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=c1>// Grand Parent Menu
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=err>children:</span> <span class=err>[</span>
</span></span><span class=line><span class=cl>        <span class=err>{</span>  <span class=c1>// Parent Menu
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=err>children:</span> <span class=err>[</span>
</span></span><span class=line><span class=cl>            <span class=err>{</span>  <span class=c1>// Child Menu
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=err>...menu,</span> <span class=c1>// &lt;- Menu details
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl>      <span class=err>]</span>
</span></span><span class=line><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=cl>  <span class=err>]</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h3 id=putting-it-all-together>Putting it all together<a hidden class=anchor aria-hidden=true href=#putting-it-all-together>#</a></h3><p>Compiling all together, the middleware looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=nx>handle</span><span class=p>({</span> <span class=nx>request</span><span class=p>,</span> <span class=nx>view</span> <span class=p>},</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// call next to advance the request
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Can be MongoDB Model, this is AdonisJS
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>MenuService</span> <span class=o>=</span> <span class=nx>use</span><span class=p>(</span><span class=s2>&#34;App/Services/Admin/MenuService&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>menuService</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MenuService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>menus</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>menuService</span><span class=p>.</span><span class=nx>findAll</span><span class=p>(</span><span class=s2>&#34;position&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>builtMenu</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>menuWithParent</span> <span class=o>=</span> <span class=p>[];</span> <span class=c1>// Stores all menu that has parent for later processing
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// First of all, gather all the menus with same position to the same index
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>menus</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// The position for the current menu does not exist in the builtMenu object 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Create it with an empty array
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If this menu does not have parent, push it directly into its position key in the builtMenu variable
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>menu</span><span class=p>.</span><span class=nx>parent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Else, push for later processing
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>menuWithParent</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>sortedMenu</span> <span class=o>=</span> <span class=p>{};</span> <span class=c1>// Holds all the menu that has been sorted
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Sorts all the menu in their respective positions, just to maintain ordering
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>builtMenu</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>positionKey</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>menuAtPosition</span> <span class=o>=</span> <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>positionKey</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nx>sortedMenu</span><span class=p>[</span><span class=nx>positionKey</span><span class=p>]</span> <span class=o>=</span> <span class=nx>menuAtPosition</span><span class=p>.</span><span class=nx>sort</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>weight</span> <span class=o>&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>weight</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// This variable holds the menus that has grandparent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>menuWithGrandParent</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// We want to work on the menu that has parent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>menuWithParent</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// following the structure of our menu in the database, parentIndex is the value of the parent key of every menu that has parent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>parentIndex</span> <span class=o>=</span> <span class=nx>menu</span><span class=p>.</span><span class=nx>parent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// We still have to determine if the menu is a grandchild of a parent, so we split by the dot separator that we have used then use the length of the array as a determinant
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>hasGrandChild</span> <span class=o>=</span> <span class=nx>parentIndex</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>).</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// This menu is not a grandchild, we can proceed with our process
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hasGrandChild</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// We need to get the position of the menu
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>menusAtPosition</span> <span class=o>=</span> <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=nx>parentIndex</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>parentIndex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Decrements the parentIndex to get the index in the array, in any case the reducing by 1 is lesser than zero, we want to default to index 0 else we want to get the index in the array 
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>parent</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=nx>menusAtPosition</span><span class=p>[</span><span class=nx>parentIndex</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>parentIndex</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=c1>// If the parent does not have children, we to initialize that to an array
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Push the new child of the parent into its children
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Sort the children in the parent to maintain ordering
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>sort</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>weight</span> <span class=o>&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>weight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// This menu has a grandparent, we can not process it like this, we push to the menuWithGrandParent array and process after this
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>menuWithGrandParent</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Processes menu that has grandparent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>menuWithGrandParent</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>menu</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get the parent of the parent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>menuParent</span> <span class=o>=</span> <span class=nx>menu</span><span class=p>.</span><span class=nx>parent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Split the parent to get the index of the parent and grand parent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>indexSplit</span> <span class=o>=</span> <span class=nx>menuParent</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get the position of this menu
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>grandChildMenuPosition</span> <span class=o>=</span> <span class=nx>builtMenu</span><span class=p>[</span><span class=nx>menu</span><span class=p>.</span><span class=nx>position</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get the index of the grand parent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>grandParentIndex</span> <span class=o>=</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Set the index of the parent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>parentIndex</span> <span class=o>=</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=nx>indexSplit</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// The menus at the position of the grand child menu using the grand parent index 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>grandParentMenu</span> <span class=o>=</span> <span class=nx>grandChildMenuPosition</span><span class=p>[</span><span class=nx>grandParentIndex</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If this grand parent has children, which we expect that it should
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>grandParentMenu</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// We get the parent of the menu from the grandparent&#39;s children
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>parent</span> <span class=o>=</span> <span class=nx>grandParentMenu</span><span class=p>.</span><span class=nx>children</span><span class=p>[</span><span class=nx>parentIndex</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=c1>// if the parent exists
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=nx>parent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Initialize children on the parent if it has none
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Push the menu to the parent under the grand parent
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>menu</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// SOrt the children of the parent of the grandchild to maintain the ordering
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>parent</span><span class=p>.</span><span class=nx>children</span><span class=p>.</span><span class=nx>sort</span><span class=p>((</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>weight</span> <span class=o>&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>weight</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// At this point built menu contains keys of menu positions, the value of every keys is an array of nested values that can be passed to drag and drop UI libraries like JQuery nestable for admin configuration using a browser.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Adonis code to share values across all views.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>view</span><span class=p>.</span><span class=nx>share</span><span class=p>({</span> <span class=nx>siteMenus</span><span class=o>:</span> <span class=nx>builtMenu</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=consuming-the-menu-data-from-frontend>Consuming the menu data from frontend<a hidden class=anchor aria-hidden=true href=#consuming-the-menu-data-from-frontend>#</a></h3><p>The easiest way to consume the menu is to use a JQuery plugin called <a href=https://github.com/FrancescoBorzi/Nestable/>nestable++</a>, the plugin make updating, creating and storing of the menu easier with the data that we have.</p><p>It expects an ordered list to be populated with list items and if children is expected, the list items should contain another unordered list with the children as the list items.</p><p>In our own case, once the view has set a JavaScript object with the menu data as its value, we can do something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>CURRENT_MENU</span> <span class=o>=</span> <span class=s2>&#34;Main Menu&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>$</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>decodeHtml</span><span class=p>(</span><span class=nx>html</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>txt</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;textarea&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>txt</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>txt</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>siteMenus</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>decodeHtml</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>_siteMenus</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=c1>// This initializes the drag and drop nestable listing
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>nestableMenuBuilder</span><span class=p>(</span><span class=nx>siteMenus</span><span class=p>[</span><span class=nx>CURRENT_MENU</span><span class=p>],</span> <span class=p>{</span> <span class=nx>maxDepth</span><span class=o>:</span> <span class=mi>3</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>The <code>nestableMenuBuilder</code> function looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>nestableMenuBuilder</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>menuList</span><span class=p>,</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Creates a single menu item that the nestable understands
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>menuItem</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>$</span><span class=p>(</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  &lt;li class=&#34;dd-item&#34; data-id=&#34;</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>&#34; data-name=&#34;</span><span class=si>${</span>
</span></span><span class=line><span class=cl>      <span class=nx>item</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=cl>    <span class=si>}</span><span class=sb>&#34; data-slug=&#34;</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=nx>url</span><span class=si>}</span><span class=sb>&#34; data-new=&#34;</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=k>new</span> <span class=o>||</span> <span class=mi>0</span><span class=si>}</span><span class=sb>&#34; data-deleted=&#34;0&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  &lt;div class=&#34;dd-handle&#34;&gt;</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=sb>            &lt;span class=&#34;button-delete btn btn-default btn-xs pull-right&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            data-owner-id=&#34;</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>              &lt;i class=&#34;nestable-icon&#34; data-feather=&#34;x&#34; &gt;&lt;/i&gt;
</span></span></span><span class=line><span class=cl><span class=sb>              &lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>              &lt;span class=&#34;button-edit btn btn-default btn-xs pull-right&#34;
</span></span></span><span class=line><span class=cl><span class=sb>            data-owner-id=&#34;</span><span class=si>${</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=si>}</span><span class=sb>&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=sb>            &lt;i class=&#34;nestable-icon&#34; data-feather=&#34;edit-3&#34;&gt;&lt;/i&gt;
</span></span></span><span class=line><span class=cl><span class=sb>              &lt;/span&gt;
</span></span></span><span class=line><span class=cl><span class=sb>              &lt;/li&gt;`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>buildNestable</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>$parent</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s1>&#39;&lt;ol class=&#34;dd-list&#34;&gt;&lt;/ul&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>createChildren</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>items</span><span class=p>,</span> <span class=nx>$_parent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>items</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>$_el</span> <span class=o>=</span> <span class=nx>menuItem</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>$_parent</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s1>&#39;&lt;ol class=&#34;dd-list&#34;&gt;&lt;/ul&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>createChildren</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>children</span><span class=p>,</span> <span class=nx>$_parent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>$_el</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>$_parent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>$_parent</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>$_el</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>items</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>item</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>$_el</span> <span class=o>=</span> <span class=nx>menuItem</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>children</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>$_parent</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s1>&#39;&lt;ol class=&#34;dd-list&#34;&gt;&lt;/ul&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>createChildren</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>children</span><span class=p>,</span> <span class=nx>$_parent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>$_el</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>$_parent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>$parent</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>$_el</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>$parent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>nestableList</span> <span class=o>=</span> <span class=nx>buildNestable</span><span class=p>(</span><span class=nx>menuList</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Initializes nestable++
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;.dd.nestable&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>empty</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>nestableList</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>In our html, we have to include the nestable++ plugin from <a href=https://github.com/FrancescoBorzi/Nestable/blob/master/jquery.nestable.js>here</a> and its css from <a href=https://github.com/FrancescoBorzi/Nestable/blob/master/style.css>here</a> and <a href=https://code.jquery.com/jquery-3.4.1.min.js>JQuery</a>, then create an <code>ol</code> with class names <code>dd nestable</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>ol</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;dd nestable&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>ol</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>And, that is it.</p><h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3><p>There are other features of nestable that I do not include here, like updating, adding new item and deleting a menu item. I feel those are for nestable++ itself, including them here would take us out of scope for the post.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://limistah.dev/posts/asynchronous-javascript/><span class=title>« Prev</span><br><span>Asynchronous Javascript</span>
</a><a class=next href=https://limistah.dev/posts/react-unexpected-closing-tag/><span class=title>Next »</span><br><span>ReactJS - Unexpected closing tag</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on x" href="https://x.com/intent/tweet/?text=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu&amp;url=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f&amp;title=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu&amp;summary=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu&amp;source=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f&title=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on whatsapp" href="https://api.whatsapp.com/send?text=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu%20-%20https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on telegram" href="https://telegram.me/share/url?text=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu&amp;url=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Menu system in Node Apps like WordPress Menu on ycombinator" href="https://news.ycombinator.com/submitlink?t=Menu%20system%20in%20Node%20Apps%20like%20WordPress%20Menu&u=https%3a%2f%2flimistah.dev%2fposts%2fwordpress-like-menu-node-apps%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://limistah.dev>limistah</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>